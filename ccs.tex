\documentclass{sig-alternate}
\pagenumbering{arabic}

\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage[space]{grffile}
\graphicspath{figures/}
\usepackage{import}
\usepackage{url}
\usepackage{hyperref}

% http://tex.stackexchange.com/questions/57865/how-to-use-multiple-urls-for-one-bibtex-reference
\let\URL\url
\makeatletter
\def\url#1{\@URL#1||\@nil}
\def\@URL#1|#2|#3\@nil{%
  \URL{#1}\ifx\relax#2\relax\else| \URL{#2}\fi}
\makeatother

\usepackage{subcaption}
\usepackage{tikz}
\usepackage{siunitx}
\usepackage{todonotes}%[disable]
\let\OldTodo\todo
\renewcommand{\todo}{\OldTodo[inline]}
\newcommand{\todolater}[1]{}%{\todo{#1}}%
\RequirePackage[date=terse, isbn=true, doi=true, url=false, urldate=iso8601, maxbibnames=9, backref=false, backend=bibtex, style=ieee]{biblatex}
\addbibresource{securityupdates.bib}
\renewcommand{\bibfont}{\small}

\AtEveryBibitem{% Clean up the bibtex rather than editing it
 \clearname{editor} % remove editors
}

\input{dastats}
\newcommand{\da}{Device Analyzer}
\newcommand{\dafoot}{\textsuperscript{\ref{foot:dadata}}}
\input{avostats}
\newcommand{\avo}{AVO}
\newcommand{\percMarketShare}{83.6\%~\footnote{\url{http://www.theinquirer.net/inquirer/news/2379036/android-hits-836-percent-marketshare-while-ios-windows-and-blackberry-slide}}}
\newcommand{\daNumDevices}{\daNumOSDevices}
\newcommand{\daDeviceDays}{\daOSTotalDaysData}
% Num versions since \daStartDate
\input{countversions}
\newcommand{\otherProjNum}{\avoNumExternalProjects}%TODO check we are doing the right calculation here and not overcounting

% Blinding function
\newcommand{\identifying}[1]{#1}%{}%
\newcommand{\blindauthors}[1]{#1}%{Paper \#XX}%

% Terminology

% Android, Unix, adb
% update, release, patch: what do we actually mean and what relevance does that have to security?
% Device manufacturers
% Network operators
% Device model TODO check
% Device handset TODO check


\begin{document}
%
% --- Author Metadata here ---
\conferenceinfo{SPSM}{2015 Denver, Colorado, USA}
%\CopyrightYear{2015} % Allows default copyright year (20XX) to be over-ridden - IF NEED BE.
%\crdata{0-12345-67-8/90/01}  % Allows default copyright data (0-89791-88-6/97/05) to be over-ridden - IF NEED BE.
% --- End of Author Metadata ---

\title{Measuring security performance in the Android ecosystem}

\numberofauthors{3}
\author{
\href{http://orcid.org/0000-0001-8936-0683}{Daniel~R.~Thomas}
\and
Alastair~R.~Beresford\\
       \affaddr{Computer Laboratory}\\
       \affaddr{University of Cambridge}\\
       \affaddr{Cambridge, United Kingdom}\\
       \email{Firstname.Lastname@cl.cam.ac.uk}
\and
Andrew~Rice
}


\maketitle

\begin{abstract}
The security of Android depends on security updates for critical vulnerabilities  being shipped to devices.
Using a corpus of \daNumOSDevices\ devices we show that there is significant variability in the timely delivery of security updates across different device manufacturers and network operators.
We define a security metric to rank the performance of device manufacturers and network operators.
This provides a comparison point for purchasers to determine which device manufacturers and network operators to use.
We argue that publishing metrics like this provides an important incentive to manufacturers and operators to ship security updates.
\end{abstract}

% A category with the (minimum) three required fields
\category{Security and privacy}{Systems security}{Operating systems security}[Mobile platform security]
\category{Security and privacy}{Systems security}{Vulnerability management}

\terms{Economics, Measurement, Security}

\keywords{Android, updates, vulnerabilities, metrics, ecosystems}

\section{Introduction}

It has been previously shown that Android devices do not receive security updates promptly when critical vulnerabilities are publicly disclosed and hence \daMeanInsecurityPercNominal\ are exposed to known critical vulnerabilities on average~\cite{androidvulnerabilities.org}.
Here we attempt to determine why by understanding the Android update process, apportioning blame to different entities in the ecosystem and producing a scoring metric to compare different entities.

By producing a scoring metric which compares different entities such as device manufacturers, network operators or specific device models we can provide information which allows device purchasers to select devices with better security.
Currently corporate and public sector buyers are encouraged to purchase secure devices, but we have found little concrete guidance on the specific makes and models providing the best security.
For example, CESG, which advises the UK government on how to secure its computer systems, recommends picking Android device models from device manufactures which are good at shipping security updates promptly but it does not state which device manufacturers these are~\cite{CESG2013}.
We are also collaborating with a FTSE 100 company to give them concrete information to answer this question.
To address this, we developed a scoring system and provide numbers on the historic performance of device models in the \da\ project in~\S\ref{sec:security_scoring}.
We provide the answer to the question ``Who should I buy my Android phone from for best security?'', showing that in general Nexus devices are better, further details are given in~\S\ref{sec:security_scoring:results}.

The Android update process is slow because its development is distributed among many parties and has a long multi-stage pipeline~\cite{HTC2013}.
The security of Android relies on many open source projects, these include the Linux kernel, OpenSSL and BouncyCastle as well as Google who build the core platform.
In addition, device manufacturers (we know of \daNumManufacturers\footnote{\label{foot:dadata}We computed this from the \da~\cite{Wagner2013} data, see \S\ref{sec:android_update_process}.}) and network operators (\daNumOperators\dafoot) may make further modifications before devices are shipped to customers.
Understanding this ecosystem is important as device manufacturers have introduced additional vulnerabilities in the past~\cite{Grace2012}.
We present a better understanding of both the ecosystem of Android development and associated vulnerabilities more fully in~\S\ref{sec:android_ecosystem}.

\begin{figure}
\centering
\includegraphics[width=\columnwidth]{figures/proportioninsecure}
\caption{Proportion of devices running insecure, maybe secure and secure versions of Android against time.
The red vertical lines are caused by vulnerabilities being discovered with those which have the biggest impact annotated.
}
\label{fig:proportioninsecure}
\end{figure}
By using data from \da~\cite{Wagner2013} we can examine the versions of Android running on user devices over time and through comparison with data on which versions of Android were vulnerable to different critical vulnerabilities~\cite{androidvulnerabilities.org} we can plot the exposure of Android devices to known critical vulnerabilities.
Figure~\ref{fig:proportioninsecure} shows that Android devices are often exposed to known security vulnerabilities.
One solution to this problem is regulation, and indeed there is ongoing legal action to force network operators to ship updates for security vulnerabilities~\cite{Soghoian2013}.\todolater{Check on the status of this legal action}
Many smartphones are sold on 12--24 month contracts, and yet our data shows many devices do not receive many security updates, with an overall average of \daUpdatesPerYearNominal\ per year. 
In contrast, Windows XP could be purchased for a one-off payment in October 2001 and received security updates monthly until April 2014.
An alternative to regulation is access to publicly available data.
Comparative data, which we provide in this paper, would provide an incentive to both device manufacturers and network operators to provide updates.

In summary, the contributions of this paper are:
\begin{itemize}
 \item We quantify the Android update process~\S\ref{sec:android_ecosystem}.
 \item We propose the FUM scoring metric to evaluate the security of different instances of a platform~\S\ref{sec:security_scoring:method}.
 \item We measure the security of Android according to this and compare different device manufacturers, device models and network operators to allow device purchasers to differentiate between them based on security~\S\ref{sec:security_scoring:results}.
\end{itemize}

We indicate the uncertainty in our results by presenting them $\pm$ one standard deviation and give results to 3~s.f., this occasionally results in `$\pm\, 0$' when the standard deviation is small.
\todolater{Do we want to use the 95 percentile instead}
We explore systematic errors in \S\ref{sec:representative}.

\section{Android Ecosystem}\label{sec:android_ecosystem}
There is a complex Android ecosystem which creates and distributes updates to Android which fix vulnerabilities.
In this section we describe how the Android ecosystem functions and how Android versions are produced, as seen by the \da\ project.


\subsection{Android update process}

\label{sec:android_update_process}
\begin{figure}[h]
 \centering
 \def\svgwidth{\columnwidth}
 \import{figures/}{update_ecosystem.pdf_tex}
 \caption{Flow of updates between participants in the Android ecosystem.
 Numbers on edges indicate updates shipped between \daStartDate\ and \daEndDate, those in brackets represent number of such entities.
 Dotted arrows indicate flows where we can't measure how many updates are produced as they are not public.}
 \label{fig:update_ecosystem}
\end{figure}
To understand how vulnerabilities in Android are fixed we examine the Android update process which we model in Figure~\ref{fig:update_ecosystem}.
There are five entities or groups which contribute towards Android updates: the network operators, the device manufacturers, the hardware developers, Google and the upstream open source projects.
Android builds on various open source projects such as the Linux kernel, OpenSSL and BouncyCastle cryptography libraries.
Consequently Android can include any compatible versions of those projects, including those which fix security vulnerabilities.
Android also incorporates various drivers for different bits of hardware.
The Android platform is then built from these components by Google.
The code for each Android release or update is kept secret until after a binary release has been published.\footnote{\url{https://source.android.com/source/code-lines.html}}
Device manufacturers likely receive advanced access in order to prepare handsets so they can customise it before passing it on to the network operator.
The network operator may then make or request further customisations and perform further testing before shipping the update to the Device.
Sometimes device manufactures ship updates directly to the user, sometimes the device manufacturer and Google collaborate closely to make a particular phone, such as with Nexus devices.
Sometimes device manufacturers incorporate upstream open source project releases directly, and sometimes incorrectly -- for example previous work has recorded evidence of broken nightly builds of sqlite in Android releases~\cite{Wagner2013}.

The numbers of devices (\daNumOSDevices), network operators (\daNumOperators) and device manufacturers (\daNumManufacturers) in Figure~\ref{fig:update_ecosystem} come from the \da\ data.
Device manufacturer and network operator counts were obtained by normalising the results reported by Android to \da\ of the device manufacturer and active network operator.
This normalisation is a manual task involves removing invalid values (such as `manufacturer' or `airplane mode is on'), collating across company name changes (e.g.\ `lge' to `LG'), normalising punctuation, removing extra strings sometimes added such as (`(2g)' or `communications') and mapping some incorrectly placed model names back to their manufacturer.
This normalisation is not perfect and so these are overestimates on the \da\ data but they are likely still underestimates as there will be some device manufacturers and network operators which are not included in the \da\ data.

In Figure~\ref{fig:update_ecosystem} the number of updates received by devices (\daNumFullVersions) is the number of different full version strings observed in \da.
The number of updates shipped by Google (\daNumSigOSVersions) is the number of Android versions reported in \da\ which affected more than \daSigVersionPerc\ of devices for more than \daSigVersionDays\ days.
This significance test is to remove spurious versions recorded in \da\ such as `5.2.0' in 2012 which had still not been released in 2014.

We extracted data on the external projects used in Android and have included this and the scripts which generated it in AndroidVulnerabilities.org (\avo)~\cite{androidvulnerabilities.org}.
These scripts analysed the Android Open Source Project's source tree to examine the source code of each of the external projects to find the project version associated with each Android version tag on the repository.
There are \avoNumExternalProjects\ external open source projects in Android, contributing \avoTotalExternalLines\ lines of code.
We analysed the top \avoNumBigExternalProjects\ by lines of code (\avoBigExternalLinesOfCodePerc\ of the total) and were able to automatically extract the versions of those projects included in different versions of Android for \avoNumAnalysedExternalProjects\ of these (\avoAnalysedExternalLinesOfCodePerc\ of the total).
We found \avoBigExternalTotalVersions\ distinct versions, a median of \avoBigExternalMedianVersions\ and mean of \avoBigExternalMeanVersions\ versions per project.
Android rarely changes the version of external projects it includes.

%An analysis by Vidas et al.~\cite{Vidas2011} of the Android 2.1 to 2.2 update found that it took 11 months from when Google released 2.2 for the last device which they were investigating to get the update.
To compute the latency between upstream releases and their inclusion in Android we scraped the release pages for those projects, to obtain the version numbers and release dates.
This allows us to compute the latency between an upstream project being released and it being included in Android, this is shown in Table~\ref{tab:update_ecosystem}.
The versions included in Android were about half a year old when the first version of Android containing it was released.
\begin{table}
\centering
\normalsize
\begin{tabular}{l|r|r}
Project	&	\# releases	&	latency (days) \\ \hline
linux	&	\linuxNumVersions	&	\linuxMeanUpdateLatency \\
openssl	&	\opensslNumVersions	&	\opensslMeanUpdateLatency \\
bouncycastle	&	\bouncycastleNumVersions	&	\bouncycastleMeanUpdateLatency \\
\end{tabular}
\caption{Flow of updates from upstream projects into Android. Number of updates as in Figure~\ref{fig:update_ecosystem}, latency in days for all pairs of versions we have data on.\todolater{scrape the other 26 websites... is it worth it?}}
\label{tab:update_ecosystem}
\end{table}

\section{Threat model and attack vectors}
\label{sec:threatmodel}

We assume the defender can deploy security controls at three levels: in an online marketplace, at app installation, and during app execution.
Here we consider three attack vectors against Android handsets.

The first attack vector is through the installation of a malicious app on the device.
Android devices can install apps through marketplaces, email attachments, URLs and via the Android Debug Bridge (ADB).
By default, many Android devices will only allow the installation of apps from Google play which uses Bouncer to automatically analyse apps; and quickly takes down apps that are reported as malicious.
However alternative markets are also popular, particularly in countries where Google Play is not available.

The second attack vector is to make an existing app into download and execute code at runtime.
The most direct method is to upload to a marketplace a seemingly innocent app that dynamically loads malicious code.
Neither static nor dynamic analysis of this app will uncover any malicious code, since it does not exist in the app.
The marketplace can detect explicit use of dynamic code loading, however dynamic code loading is not actually needed for this to work -- it just makes the task easier -- even on a platform such as iOS, which does not permit dynamic code loading, a Return-Oriented Programming (ROP) attack is relatively easy if the attacker creates an app with carefully crafted flaws~\cite{Wang2013a}.

The third attack vector is that the attacker injects malicious code directly into existing code already on the handset. 
For example, the addJavascriptInterface vulnerability (CVE-2012-6636) allows JavaScript running in an Android WebView to execute arbitrary code as the vulnerable app's user~\cite{Thomas2015a}.
The fix for the addJavascriptInterface vulnerability breaks backwards compatibility and requires a two sided fix.
While the fix was released in December 2012, on \daGPAPISeventeenLaterDate, \daGPAPISeventeenEarlierProportion\ of handsets connecting to Google Play were still vulnerable to this attack.

The best place to prevent attacks is at runtime, since all three attack vectors can be prevented at this level. 
Unfortunately, it has been demonstrated that the sandbox for Android apps is weak~\cite{androidvulnerabilities.org}.


\section{Critical vulnerabilities}
We have used data on critical vulnerabilities in Android from AndroidVulnerabilities.org (\avo)~\cite{androidvulnerabilities.org}.
It contains information on the discovery and publication dates, the versions affected and which versions contained fixes.
It only contains critical vulnerabilities such as root vulnerabilities that did not require USB debugging to exploit.
If malicious code exploits a critical vulnerability then it gains control of the device.

Some critical vulnerabilities are not traditional kernel vulnerabilities, but are vulnerabilities in level 1 of our threat model.
For example improper verification of signatures at installation time was discovered in February 2013~\cite{Forristal2013} and meant that applications could pretend to be signed with system keys and hence be granted system privileges.
On versions of Android below 4.1 malware could then use known system-to-root escalation mechanisms.
Regardless of version, this exposed an increased attack area and would also provide the ability for malware to control all user internet traffic (via VPNs), brick the phone, remove and install apps, steal user credentials and read the screen.
The different categories which the vulnerabilities fall into are shown in Table~\ref{tab:andvulns}, `signature' vulnerabilities are level 1 while kernel and system vulnerabilities are level 2.\todo{What is going on with these levels?}
\avoTabAndVulns

\avo\ currently contains \avoNumVulnerabilities\ vulnerabilities of which \avoNumVulnAllAndroid\ affect all Android devices and \avoNumVulnSpecific\ are specific to particular devices or device manufacturers.

Unless otherwise stated, we use the \daNumVulnsUsed\ vulnerabilities shown in Table~\ref{tab:andvulns} in our analysis.
We have chosen these vulnerabilities to fit the attack vectors introduced in \S\ref{sec:threatmodel}.
These vulnerabilities affect all Android devices regardless of manufacturer, and as a result our selected vulnerabilities will dominate any security analysis of Android. \todo{can we make this sentence clearer?}
Hence, with our chosen set of vulnerabilities, our analysis represents a lower-bound on the vulnerability of devices in the \da\ data.

\input{security_scoring}

\section{Comparison with other data}\label{sec:representative}
Here we show that the \da\ data~\cite{Wagner2013} is representative for our purposes by comparing it with two other sources of data which provide an upper and lower bound on it.
The \da\ data is collected from devices across the world where users have voluntarily installed the app.
We have obtained comparable data on 5\,290 devices from a multinational FTSE 100 company's mobile device management database which includes company and employee owned devices, and from 5\,170\,000 matching User-Agent headers on all HTTP traffic for 30\% of Rwanda for a week.
\todo{citation for Rwanda dataset}
\begin{figure}
\centering
\includegraphics[width=\columnwidth]{figures/dists}
\caption{Comparison between FTSE, User-Agent and the corresponding \da\ data, error bars indicate 95\% confidence intervals.}
\label{fig:dists}
\end{figure}
We used the data from the FTSE 100 company for the week ending 2015-04-27 and the User-Agent data was collected between 2015-01-31 and 2015-02-12.
Figure~\ref{fig:dists} shows the proportion of devices running each Android OS version in the two comparison data sets and the comparable periods from \da.
The general pattern this shows is that in the FTSE data newer versions are more popular than in the \da\ data and that in the Rwanda data old versions are more popular than in the \da\ data.
\todo{Can we quantify this?}
This shows that \da\ lies between these two biased samples while being similar to both and so is representative.

\section{Related work}
The update process for apps, security fixes and OS upgrades also needs to be secure.
Unfortunately, package management systems designed to provide secure updates have been found to contain vulnerabilities~\cite{Cappos2008} and many software update systems fail to authenticate the connection between the device and the update server or do not authenticate the downloaded binaries~\cite{Bellissimo2006}.
Android does authenticate update binaries and Google Play downloads them over a secure connection~\cite{Viennot2014}.
In this paper we have analysed four critical vulnerabilities in the Android app update mechanism: APK unsigned shorts, APK unchecked name, APK duplicate file and Fake ID.
Other work has demonstrate complex and subtle errors exist in the Android app update process.
For example, the process can be exploited to allow apps to gain privilege through `Pileup' vulnerabilities by registering for new permissions before the update which creates that permission is installed~\cite{Xing2014}.

\interfootnotelinepenalty=10000 %To stop the lifehacker footnote below from spanning multiple pages and breaking
User-Agent strings have been used to investigate the timeliness of web browser updates, with at most 80\% of Firefox users running the most recent version~\cite{Frei2008}.
The same analysis was used to show that Chrome's use of silent updates seems to increase uptake of upgrades~\cite{Duebendorfer2010} with 97\% of users running the latest version within 3 weeks of release.
By way of comparison, Android's update process is manual.
The user is notified an update exists, but further action is required, including downloading the update and rebooting the phone to enable installation.
The phone must have sufficient charge to perform the update and the device itself is rendered inoperable during the update process, two factors which might prevent or delay the update process from taking place.
In our data we are unable to determine why a device is not updated. 
It is possible that many updates arrive at handsets, but are simply not installed.
Anecdotal evidence at least suggests that it is the lack of updates rather the lack of installation which is the major problem at present. Further work is required to tease these numbers apart.
Partly this is the result of the fact that an operating system update is being installed and so a reboot is required, but Chrome installs the new version side by side with the old one and switches the next time it is restarted.
The same technique would be more difficult on phones with limited storage space (as many cheap Android phones have barely enough space to install just the update) but is a plausible improvement for more high-end devices.
Google is deploying the same silent update technique through Google Play Services\footnote{\href{http://lifehacker.com/why-google-play-services-are-now-more-important-than-an-975970197}{http://lifehacker.com/why-google-play-services-are-now-more-important-than-an-975970197}} which automatically installs updates for core Google components of Android, this also bypasses the device manufacturer and network operator.

Security in depth is also a useful strategy.
In this regard, iOS provides additional safeguards beyond those used in Android, including a pre-distribution review, mandatory code-signing by the manufacturer, and (with the important exception of ROP-based attacks~\cite{Wang2013a}) the technical prohibition of dynamic code loading by an app.
These features, as well as Address Space Layout Randomisation (ASLR) and mandatory access controls, has resulted in a lower level of malware affecting iOS when compared to Android~\cite{Felt2011}.

There are continuing efforts to reduce the impact of critical vulnerabilities, both in Android and elsewhere.
SE\-Android~\cite{Smalley2013}, which is included in Android from version 4.1~\cite{jelly-bean-release}, and fully enforcing from version 5.0~\cite{AndroidSecurity2014} claimed to prevent some root vulnerabilities and to reduce the impact of others.
Capability based enforcement systems such as Capsicum~\cite{Watson2010} substantially reduce the capabilities that an exploit has to try and gain increased privilege with and could be included in Linux\footnote{\url{https://github.com/google/capsicum-linux}} and hence Android.

Rather than fixing critical vulnerabilities, security can be obtained by detecting malicious apps and preventing their installation or execution.
Detection strategies include Risk\-Ranker, which classified 3\,281 out of 118\,318 apps (2.8\%) as risky of which 718 (22\%) were malware and 322 (10\%) were previously unknown malware, an infection rate of 0.6\% across multiple markets~\cite{Grace2012a}.
Droid\-Ranger also analysed apps finding 148 out of 182\,823 apps (0.08\%) to be malicious across multiple markets of which 29 were previously unknown~\cite{Zhou2012a}.
%DroidRanger: It used permission-based behavioural fingerprinting which looked at the permissions of known malware and heuristic-based filtering -- dynamic loading of both Dalvik and native code.
A common technique used by attackers is to include malicious code in repackaged popular apps. 
An\-Darwin uses this insight to detect similar apps, and found 169 out of 265\,359 of all apps studied (0.06\%) were malicious clones~\cite{Crussell2013}.
%AnDarwin: It used clustering based on semantic vectors derived from the program dependence graphs to detect similar apps.

The percentage of Android devices running the most recent version (\daUpdatednessPerc) is much less than the rate ($>90$\%) for Windows XP SP2 computers contacting the Microsoft update servers~\cite{Gkantsidis2006}.
A simple numerical comparison is unfair because only one major OS version was considered in the Microsoft analysis, and data was only collected from computers which contacted the update server, although this was the default.
More recent data demonstrates the difficulty of upgrading computers between major OS versions, with 27\% of Windows computers running Windows XP in July 2014,\footnote{\url{https://archive.today/PLGxn}} four months after Windows XP stopped receiving security updates.

\cite{Nappa2015}
\cite{Zhang2014}
\cite{Lindorfer2014}
\cite{Arp2014}

\section{Conclusion}
 and examined how the Android ecosystem results in different device models receiving different levels of security due to whether or not they get security updates
We have compared different device models, device manufacturers and network operators and found that there are differences between them which the discerning purchaser might use to influence their decision about which device model to buy from which device manufacturer and network operator.
We hope that this analysis will encourage device manufacturers and network operators to improve the support they provide for devices after sale.

\section*{Dataset}
The raw and processed data and source code will be made available where possible.
Data from \da\ and \avo\ used in this paper is already available.

\sloppy
\section*{Acknowledgements}
\identifying{
This work was supported by a Google focussed research award; and the EPSRC [grant number EP/P505445/1].
}

\printbibliography


\end{document}
