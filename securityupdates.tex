\documentclass[conference,a4paper,twoside]{IEEEtran}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{url}
\usepackage{hyperref}
\RequirePackage[date=terse,isbn=true,doi=true,url=false,urldate=iso8601,maxbibnames=9,backref=false,backend=bibtex]{biblatex}
\addbibresource{securityupdates.bib}
\renewcommand{\bibfont}{\small}

\AtEveryBibitem{% Clean up the bibtex rather than editing it
 \clearname{editor} % remove editors
}

\author{Daniel R.\ Thomas, Daniel T.\ Wagner, Alastair R.\ Beresford and Andrew Rice}

\input{dastats}
\newcommand{\percMarketShare}{XX\%~\cite{TODO}}
\newcommand{\daNumNetworkOperators}{XXX~[\S\ref{sec:results}]}
\newcommand{\daNumDevices}{XXXX}
\newcommand{\daDeviceDays}{XXXXX}
\newcommand{\daMonths}{X}% Number of months for which we have the below number of devices
\newcommand{\daMonthsDevices}{XXX}
\newcommand{\daAdbPerc}{X\%}

\begin{document}
\title{Timeliness of security updates for Android}


% author names and affiliations
% use a multiple column layout for up to three different
% affiliations
\author{
\IEEEauthorblockN{Daniel R. Thomas,
Daniel T. Wagner,
Alastair R. Beresford,
Andrew Rice}
\IEEEauthorblockA{
Computer Laboratory\\
University of Cambridge\\
Cambridge, United Kingdom\\
Firstname.Lastname@cl.cam.ac.uk
}
}


\maketitle

% Hypothesis
% Attempts at fine grained restrictions on running arbitrary code are hampered by updates for security vulnerabilities not reaching users in a timely fashion.

\begin{abstract}
Android is the most popular smartphone platform and seeks to provide better security than popular desktop operating systems through increased compartmentalisation and a permission system for apps.
This security relies on the absence of root privilege exploits which allow apps to bypass all protections.
Many such exploits have been found and fixed.
Our hypothesis is that these fixes do not promptly reach the users devices and so much of the time users are running versions of Android known to be vulnerable.
We found that on average over \daMeanInsecurityPerc\ of devices were exposed to known root privilege vulnerabilities and only \daUpdatednessPerc\ of devices run the most recent version of Android.
There was also a period of several months when no devices ran secure versions of Android.
We compare different manufacturers and operators to find which are best at promptly distributing security updates and examine how to improve the situation.
Many phones are sold on long (18 month) contracts with monthly payments yet stop receiving updates before the end of the contract, while Windows XP could be purchased for a one off payment in October 2001 and received security updates until April 2014.
\end{abstract}

\section{Introduction}
Android has \percMarketShare\ of the smartphone market and while the core development is controlled by Google there are at least \daNumManufacturers\ manufacturers which make devices which run Android.
Many of these manufacturers customise the version of Android they ship and sometimes network operators (of which there are at least \daNumNetworkOperators) make further modifications.
Hence when Google produces an update to Android, the update may have to pass through the manufacturer and operator before reaching the user.
The manufacturer and operator have little financial incentive to perform this work as they have already sold the device.
Operators are particularly cautious because if they ship a broken update then they will get many support requests which is expensive.
However there is ongoing legal action to force operators to ship updates for security vulnerabilities~\cite{Soghoian2013}.
CESG, which advises the UK government on how to secure its computer systems, recommends picking Android devices from manufactures which are good at shipping security updates promptly~\cite{CESG2013} but it does not state which manufacturers are better.
We provide this information in~\S\ref{sec:security_scoring}.

Android relies on the Linux kernel to provide compartmentalisation and runs each app as a separate unix `user'.
The Linux kernel is a large piece of software and so there will always be new root exploits found in it~\cite{TODO}.
Manufacturers of Android devices have also added further root exploits when customising it~\cite{Grace2012}.
Between 36.7\%~\cite{Zhou2012b} and 40\%~\cite{Zhou2012a} of malware for Android contains root exploits.
While this shows that much Android malware does not need a root exploit to work, it can just request the relevant permissions and the user will grant them, a significant proportion does.
This malware is also more dangerous because while ordinary malware can be remotely removed by Google through the Play store, once a root exploit has been used there are no guarantees.

Figure \ref{fig:proportioninsecure} shows the proportion of Android devices in the DeviceAnalyzer data which were running versions of Android known to root exploits at the time.
In \S\ref{sec:background} we will explain where these data comes from and then in \S\ref{sec:results} we will show these data in more detail.

\begin{figure}[!b]
\centering
\includegraphics[width=\columnwidth]{figures/proportioninsecure}
%TODO make this graph shorter
\caption{Proportion of devices running insecure versions of android}
\label{fig:proportioninsecure}
\end{figure}

In the past users of Microsoft IIS were advised to switch to a different web server due to the high rate of vulnerability~\cite{Pescatore2001} this pressure helped cause Microsoft to focus on security so that it now does much better~\cite{TODO}.
Part of the reason why deployed devices do not receive updates in a timely manner is that there is little data on what is actually happening and so it is not possible to determine which manufacturers or operators are doing a better job, this data is in~\S\ref{sec:security_scoring}.
Hence there is little incentive for manufacturers and operators to do a better job, we will discuss this further in \S\ref{sec:economics}

\section{Background}
\label{sec:background}
There are two sources of data we needed for this study, information on root exploits and information on installed versions of Android.

\subsection{Root exploits}
We compiled a list of root exploit vulnerabilities for Android containing information on when they were known about, what versions they affected and which versions fixed the problem.
We only looked for \emph{root equivalent} exploits which did not require USB debugging to exploit.
\emph{Root equivalent} means that it grants privileges equivalent in scope to root which can then be used to gain root.
Some phones can be `rooted' by enabling USB debugging and using the special privileges of the adb shell to root the device but only \daAdbPerc\ of devices have USB debugging enabled.
This is not something that applications running on the phone can exploit to break compartmentalisation and so we do not include those exploits.
Some exploits which grant root are not traditional kernel exploits, for example the discovery of flaws in the verification of signatures on Android applications in February 2013~\cite{Forristal2013} meant that applications could pretend to be signed with system keys and hence gain root privileges.

We have published full details of the vulnerabilities listed below in an accompanying technical report~\cite{TODO} and summarise them in Table \ref{tab:andvulns}.
We also have a website\footnote{\url{http://androidvulnerabilities.org/}} which we will keep up to date with future vulnerabilities and which has successfully solicited submissions from others.

\begin{table}
\centering
\begin{tabular}{c|c|c}
Vulnerability & Date known & How known \\
\hline
Exploid & 2010-07-15 & Public disclosure \\
Psneuter & 2011-01-06 & Public disclosure \\
Levitator & 2011-03-10 & CVE registered \\
ZergRush & 2011-10-06 & Exploit developed \\
APK duplicate file & 2013-02-18 & Fix committed \\
APK unsigned shorts & 2013-07-03 & Fix committed \\
% TODO this is an incomplete list, we need to add the rest here and in os-version.py
\end{tabular}
\caption{Root equivalent vulnerabilities in Android}
\label{tab:andvulns}
\end{table}

\subsection{Versions of Android running on devices}
We also need historical information on which versions of Android were running on devices along with other information about those devices which allows us to go into more detail and confirm the reliability of the data our results depend on.
The only suitable data which is available for this is the Device Analyzer data~\cite{Wagner2013}.
The Device Analyzer data contains data from \daNumDevices\ devices with a total of \daDeviceDays\ device days, it contains data for more than \daMonths months for \daMonthsDevices\ devices.
%TODO talk about the Device Analyzer project a bit
Various different kinds of data\footnote{\url{https://deviceanalyzer.cl.cam.ac.uk/collected.htm}} are collected by the Device Analyzer Android app\footnote{\url{https://deviceanalyzer.cl.cam.ac.uk/}}.
Among these are the build string and API version for the version of Android currently running on the device each day.
The API/SDK version is a well defined integer, however it does not always change with new Android releases, particularly security bug fixes should not increase this value.
The build string is `The user-visible version string', fortunately most (99.9\%) devices in the data have a build string of the form `x.y.z random string' and so it is possible to extract the Android version number.

\subsection{Running a version of Android known to be vulnerable makes a device vulnerable}
While we have not tried to exploit these vulnerabilities on the devices in order to test whether the devices are actually vulnerable, we are confident that most devices.

\section{Results}
\label{sec:results}
In this section we present the results of our analysis showing ????. %TODO summarise our results

The data from Device Analyzer (DA) we want to use to investigate the proportion of devices exposed to different vulnerabilities is the OS version.
Unfortunately there is no authoritative source of OS version information and so we cannot check directly whether our data is representative.
However Google has published API version information every month since December 2009 and we have collated this information.\footnote{\url{https://www.cl.cam.ac.uk/~drt24/android/versiondistribution/}}
While API versions are too coarse grained to use for security update detection they are closely related to OS versions and so if the DA data on API versions is similar to the Google Data on API versions then the DA data on OS versions should be representative.
Figure \ref{fig:play_api} shows the data Google and Figure \ref{fig:da_api} and they appear similar. %TODO we want a statistical metric to claim this strongly with.
\begin{figure}
 \centering
 \includegraphics[width=\columnwidth]{figures/play_norm_api_trunc}
 \caption{Google Play data on proportion of devices running different Android API versions}
 \label{fig:play_api}
\end{figure}
\begin{figure}
 \centering
 \includegraphics[width=\columnwidth]{figures/da_norm_api}
 \caption{Google Play data on proportion of devices running different Android API versions}
 \label{fig:da_api}
\end{figure}

This allows us to have confidence in the OS version information.
Figure \ref{fig:os} shows the raw data on the number of devices in the Device Analyzer data running different versions of Android each day.
It shows how old versions are gradually replaced by new ones, the long tail of devices which do not see updates to more recent versions and the fluctuation in the number of devices in the data.
Figure \ref{fig:norm_os} shows the normalised OS version distribution.
\begin{figure}
 \centering
 \includegraphics[width=\columnwidth]{figures/os}
 \caption{Android versions in Device Analyzer data over time}
 \label{fig:os}
\end{figure}
\begin{figure}
 \centering
 \includegraphics[width=\columnwidth]{figures/da_norm_os}
 \caption{Android versions in Device Analyzer data over time}
 \label{fig:norm_os}
\end{figure}

Figure \ref{fig:vulnerabilities} shows which vulnerabilities devices are exposed to.
For each vulnerability it shows the proportion of devices exposed to that vulnerability and how that changes over time.
In July 2011 at the beginning of the Device Analyzer data the Exploid and Levitator vulnerabilities both affect most Android devices, slowly these are fixed as updates roll out and devices are replaced until in January 2013 a much smaller proportion of devices are affected by known vulnerabilities.
However when in February 2013 the first APK signing vulnerability was found which affected all previous versions of Android and even in October 2013 most devices were still unfixed. %TODO put percentages on these things to quantify them
\begin{figure}%[!b]
\centering
\includegraphics[width=\columnwidth]{figures/vulnerabilities}
\caption{Proportion of devices exposed to each vulnerability with time (1.0 is 100\%)}
\label{fig:vulnerabilities}
\end{figure}

The variation of the proportion of devices affected by a vulnerability with time tells us how bad a particular vulnerability affected the Android platform.
Figure \ref{fig:nvulnerabilities_heat} breaks this down by vulnerability to show how the proportion of devices affected by different vulnerabilities varies.
In 2013 three vulnerabilities were found in the way which Android verified the signatures on APKs.
These allowed the creation of malicious APKs which appear to be signed as system APKs -- which have root equivalent privileges.
Figure \ref{fig:nvulnerabilities_heat} shows how the the \emph{APK signing vulnerabilities} affected all devices and took months to get fixed for any device.
However what is perhaps more worrying is the long tail on the \emph{Gingerbreak}, \emph{levitator} and \emph{exploid} vulnerabilities which are more dangerous root exploits (not requiring new APK installation) and which still affect a significant proportion of devices years later.

\begin{figure}
 \includegraphics[width=0.5\textwidth]{figures/nvulnerabilities_heat.pdf}
 \caption{Proportion of devices affected by different vulnerabilities}
 \label{fig:nvulnerabilities_heat}
\end{figure}
\begin{figure}
 \includegraphics[width=0.5\textwidth]{figures/from_to_updates.pdf}
 \caption{Updates between different Android versions in the DA data}
 \label{fig:from_to_updates}
\end{figure}
\begin{figure}
 \includegraphics[width=0.5\textwidth]{figures/w_security_updates.pdf}
 \caption{Number of updates each week which fixed or may have fixed security vulnerabilities}
 \label{fig:weekly_security_updates}
\end{figure}
Figure \ref{fig:from_to_updates} shows how devices upgrade between different versions of Android.
Device Analyzer (DA) observes upgrade events and the figure shows which versions a device is upgrading from and to.
Mostly the dark cells are above the diagonal and are upgrades.
While many upgrades are from one version to the next version there are also a fair number which skip a few versions.
Surprisingly there are also a small number of downgrade events when older versions of Android are installed on to devices.
Figure \ref{fig:weekly_security_updates} shows the number of devices getting security updates each week, blue shows updates which changed the Android version number from a version with known vulnerabilities to one which had fewer known vulnerabilities.
Red indicates updates which changed the build number but not the version number and so might contain a backported fix for a vulnerability.

\subsection{Update frequency}
%TODO find out what the frequency of updates is

\input{security_scoring}

\subsection{Monetisation}
One of the key differences between smartphones and desktops is that it is easier to directly cash out on a smartphone as malware can send premium rate texts or make premium rate phone calls.
It can also steal personal data which already has semantic information associated with it, this also makes it easier to perform ransomware attacks where malware deletes this information from the device and charges a ransom for its return.
It can also do more conventional things such as use the devices for DDoS attacks and altering the ads displayed to send the fees to the malware author.
While many of these things can be done by malware which just requests the relevant permissions, root exploits make this easier, particularly for ransomware and altering the ads displayed.

\subsection{Incentives and participants}
\label{sec:economics}
\cite{Felt2011}

\section{Related work}
\label{sec:related}
We found that since 2011 \daMeanInsecurityPerc\ of devices on average were exposed to known root vulnerabilities, in 2011 Felt et al.\ studied 6 Android handsets and found that they were exposed to root vulnerabilities at least 74\% of the time.
This might indicate that over the last 3 years the security of Android has improved, but the data are not directly comparable.
They also found that 4 of the 46 malware samples (8\%) they analysed contained root exploits, much lower than rates found in later larger studies which found rates of 36.7\%~\cite{Zhou2012b} and 40\%~\cite{Zhou2012a}.
Perhaps the malware authors heard about the results in Felt et al.'s paper?

Finding vulnerabilities is frequently a time consuming manual process but, Brumley et al.~\cite{Brumley2008} showed that it is possible to automatically generate exploits from binary patches.
In a similar way some of the vulnerabilities which have been exploited were publicly found by examining the commit made to the Android which fixed the vulnerability.
This effect has been observed before~\cite{Barth2011} in the Firefox source code repositories, Google does not release the source code until after the release of the update reducing this effect to the delay between an update being released and it reaching the last end user device.
The Woodpecker tool~\cite{Grace2012} automatically finds permission leaks in stock Android phone images.
The update process itself can allow Android apps to gain privilege~\cite{Xing2014} by registering for new permissions before the update which creates that permission is installed.


There are continuing efforts to reduce the impact of root vulnerabilities, both in Android and more widely.
SEAndroid~\cite{Smalley2013} which is included in Android from version ???~\cite{TODO} claimed to prevent some root vulnerabilities and to reduce the impact of others.
Capability based enforcement systems such as Capsicum~\cite{Watson2010} substantially reduce the capabilities that an exploit has to try and gain increased privilege with.
When Capsicum is included in Linux~\cite{TODO} and hence in Android, it could be used to place fine grained restrictions on system daemons, preventing vulnerabilities becoming root vulnerabilities.

The security protections used in iOS such as only allowing signed code to run, jails and reviewing of apps has resulted in a lower level of malware affecting iOS~\cite{TODO} but can still be bypassed~\cite{Wang2013a}. %TODO look at iOS protections again and tighten this up

Various attempts have been made to detect malware.
RiskRanker~\cite{Grace2012a} classified 3,281/118,318 (2.8\%) apps as risky of which 718 (22\%) were malware and 322 (10\%) were previously unknown, an infection rate of 0.6\% across multiple markets. It uses signatures of exploits, static analysis of calls to high risk operations, detection of encrypted native code execution and Dalvik code loading.
DroidRanger~\cite{Zhou2012a} found 148/182,823 (0.08\%) apps to be malicious across multiple markets of which 29 were previously unknown.
It used permission-based behavioural fingerprinting -- looking at the permissions of known malware and heuristic-based filtering -- dynamic loading of both Dalvik and native code.
AnDarwin~\cite{Crussell2013} detects similar apps, it found 169/265,359 (0.06\%) malicious apps based on the difference in permissions between the malicious app and the app which had been cloned.
It used clustering based on semantic vectors derived from the program dependence graphs to detect similar apps.
The Malware Genome project~\cite{Zhou2012b} collected 1,260 malware samples from 2010--2011.
They found that the best case for anti-malware detection on this data was 79.6\%.
However DroidChameleon~\cite{Rastogi2013} found that antivirus products could not detect malware if it was simply automatically permuted.
All these app analysis projects have been hampered by the difficulty of obtaining full datasets of Android apps as Google does not make these available (and researchers who automatically download them, violate Google's Terms of Service).
PlayDrone~\cite{Viennot2014} was a particularly effective project which circumvented Google's protective measures and downloaded over 1,100,000 apps from Google Play, allowing an in depth analysis.

Examining security updates has been a key way of assessing security for many years.
Many software update systems have been found not to authenticate the connection to the update server and/or do not authenticate the downloaded binaries~\cite{Bellissimo2006}.
Even package management systems designed to provide secure updates have been found to have vulnerabilities~\cite{Cappos2008}.
Fortunately Android does authenticate the update binaries (though the APK vulnerabilities circumvented this) and Google Play downloads them over a secure connection~\cite{Viennot2014}. %TODO double check that

The updatedness rate for Android of \daUpdatednessPerc\ compares unfavourable with the more than 90\% rate for Windows XP SP2 computers contacting the Microsoft update servers~\cite{Gkantsidis2006} though that is within one OS version and only for those computers which did connect to the servers -- but that is the default.

User-Agent strings have been used to investigate how web browser versions change with updates~\cite{Frei2008} and found that at most 80\% of Firefox users were running the most recent version.
The same analysis was used to show that Chrome's use of silent updates seems to increase uptake of upgrades~\cite{Duebendorfer2010} with 97\% of users running the latest version within 3 weeks of release.
Android's update process is manual, the user is notified but must action the upgrade which will then download the update and install it, the phone is rendered inoperable during the update process which is inconvenient for users and the phone must have sufficient charge so that it will not run out during the update process.
Partly this is the result of the fact that an operating system update is being installed and so a reboot is required, but Chrome installs the new version side by side with the old one and switches the next time it is restarted.
The same technique would be more difficult on phones with limited storage space (as for many cheap Android phones which have barely enough space to install just the update) but is a plausible improvement for more high-end devices.
Google is deploying the same silent update technique through Google Play Services~\cite{TODO} which automatically installs updates for core Google components of Android, this also bypasses the manufacturer and operator.



\section{Conclusion}
\label{sec:conclusion}

\printbibliography

\end{document}
